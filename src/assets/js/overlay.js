!function(){"use strict";const e={selector:"#category-overlay",bodySelector:"#overlay-body",triggerClass:".category-link",closeClass:'[data-dismiss="overlay"]',loadingClass:"overlay-loading",animationSpeed:window.tholthSettings?.overlaySpeed||300,cacheEnabled:!0,maxCacheSize:10},t=new Map;function n(){"undefined"!=typeof Salla&&Salla.ready?Salla.ready((function(){o()})):o()}function o(){const t=document.querySelector(e.selector);t?(document.addEventListener("click",(function(t){const n=t.target.closest(e.triggerClass);if(n){t.preventDefault();const e=n.href||n.dataset.url,o=n.dataset.title||n.textContent;e&&a(e,o)}})),function(t){t.addEventListener("click",(function(n){(n.target.closest(e.closeClass)||n.target===t.querySelector(".overlay-backdrop"))&&i()}))}(t),function(e){document.addEventListener("keydown",(function(t){"Escape"!==t.key||e.classList.contains("hidden")||i()}))}(t),function(e){let t=0,n=0;const o=e.querySelector(".overlay-content");o&&(o.addEventListener("touchstart",(function(e){t=e.touches[0].clientY}),{passive:!0}),o.addEventListener("touchend",(function(e){n=e.changedTouches[0].clientY,n-t>100&&0===o.scrollTop&&i()}),{passive:!0}))}(t),console.log("Tholth: AJAX overlay system initialized")):console.warn("Tholth: Overlay container not found")}function a(n,o){const a=document.querySelector(e.selector),i=document.querySelector(e.bodySelector);if(a&&i){if(a.classList.remove("hidden"),a.classList.add("overlay-opening"),a.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",function(e){const t=e.querySelectorAll('a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])');if(0===t.length)return;const n=t[0],o=t[t.length-1];n.focus(),e.addEventListener("keydown",(function(e){"Tab"===e.key&&(e.shiftKey&&document.activeElement===n?(e.preventDefault(),o.focus()):e.shiftKey||document.activeElement!==o||(e.preventDefault(),n.focus()))}))}(a),e.cacheEnabled&&t.has(n))return i.innerHTML=t.get(n),a.classList.remove("overlay-opening"),r(i),void console.log("Tholth: Loaded from cache - "+n);i.innerHTML=function(e){return'<div class="overlay-loading-state text-center py-20">  <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 dark:border-gray-100"></div>  <h3 class="mt-4 text-xl font-semibold">'+(e||"")+'</h3>  <p class="mt-2 text-gray-600 dark:text-gray-400">'+("rtl"===window.tholthSettings?.direction?"جاري التحميل...":"Loading...")+"</p></div>"}(o),a.classList.add(e.loadingClass),function(e){return new Promise((function(t,n){"undefined"!=typeof Salla&&Salla.api?Salla.api.request(e,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then((function(e){e.success?t(e.data.html||l(e.data)):n(new Error(e.error?.message||"Failed to fetch content"))})).catch(n):fetch(e,{headers:{"X-Requested-With":"XMLHttpRequest"}}).then((function(e){if(!e.ok)throw new Error("HTTP "+e.status);return e.text()})).then((function(e){t(l(e))})).catch(n)}))}(n).then((function(o){i.innerHTML=o,e.cacheEnabled&&function(n,o){if(t.size>=e.maxCacheSize){const e=t.keys().next().value;t.delete(e)}t.set(n,o)}(n,o),r(i),a.classList.remove(e.loadingClass,"overlay-opening"),console.log("Tholth: Content loaded - "+n)})).catch((function(t){i.innerHTML=function(e){const t="rtl"===window.tholthSettings?.direction;return'<div class="overlay-error-state text-center py-20">  <svg class="mx-auto h-12 w-12 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>  </svg>  <h3 class="mt-4 text-xl font-semibold text-red-600">'+(t?"خطأ في التحميل":"Loading Error")+'</h3>  <p class="mt-2 text-gray-600 dark:text-gray-400">'+e+'</p>  <button onclick="location.reload()" class="mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">    '+(t?"حاول مرة أخرى":"Try Again")+"  </button></div>"}(t.message),a.classList.remove(e.loadingClass,"overlay-opening"),console.error("Tholth: Failed to load content - "+t.message)}))}}function l(e){const t=(new DOMParser).parseFromString(e,"text/html").querySelector("#main-content, .main-content, main, .container");return t?t.innerHTML:e}function i(){const t=document.querySelector(e.selector);t&&(t.classList.add("overlay-closing"),setTimeout((function(){t.classList.add("hidden"),t.classList.remove("overlay-closing"),t.setAttribute("aria-hidden","true"),document.body.style.overflow="",setTimeout((function(){const t=document.querySelector(e.bodySelector);t&&(t.innerHTML="")}),100)}),e.animationSpeed))}function r(e){"undefined"!=typeof Salla&&(e.querySelectorAll("[salla-component], salla-button, salla-add-product-button, salla-quantity-input").forEach((function(e){"function"==typeof e.initialize&&e.initialize()})),Salla.event&&Salla.event.emit("overlay.content.loaded",{container:e}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n(),window.TholthOverlay={open:a,close:i,clearCache:function(){t.clear(),console.log("Tholth: Cache cleared")}}}();
//# sourceMappingURL=overlay.js.map
